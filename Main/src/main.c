/**
 * \mainpage SPHINCS main project
 *
 * \section Purpose
 *
 * The SPHINCS-arduino main project implements the stateless hash-based
 * signature scheme SPHINCS-256 for an Arduino Due board.
 *
 * Note that you should not rely on this project to sign any serious message.
 *
 * \section Requirements
 *
 * This whole tutorial: http://www.elecrom.com/program-arduino-due-atmel-studio/
 *
 * \section Description
 *
 * The application generates a SPHINCS key pair and signs a string message
 * according to the SPHINCS procedure.
 *
 * \section Usage
 *
 * -# Make sure to have completed the Requirements
 * -# Build the solution (F7)
 * -# Hold the ERASE button on the Arduino Due board for 2 seconds
 * -# Press the RESET button on the Arduino Due board once
 * -# Download the code on the board (Tools > Due Programmer)
 * -# Open and configure a terminal application with these settings:
 *   - 115200 bauds
 *   - 8 bits of data
 *   - No parity
 *   - 1 stop bit
 *   - No flow control
 * -# Start the application
 * -# Wait for the program to generate key pair
 * -# Send a message to be signed through the terminal application
 *
 */

#include "asf.h"
#include "stdio_serial.h"
#include "conf_board.h"
#include "conf_clock.h"

#include "parameters.h"

#include "sphincs.h"

#define MESSAGE_BYTES 73

unsigned char const message[MESSAGE_BYTES] = {
	0x49, 0x20, 0x63, 0x61, 0x6c, 0x6c, 0x20, 0x75,
	0x70, 0x6f, 0x6e, 0x20, 0x74, 0x68, 0x65, 0x65,
	0x20, 0x69, 0x6e, 0x20, 0x74, 0x68, 0x65, 0x20,
	0x6c, 0x61, 0x6e, 0x64, 0x20, 0x6f, 0x66, 0x20,

	0x74, 0x68, 0x65, 0x20, 0x64, 0x65, 0x61, 0x64,
	0x2c, 0x20, 0x74, 0x6f, 0x20, 0x75, 0x6e, 0x6c,
	0x65, 0x61, 0x73, 0x68, 0x20, 0x74, 0x68, 0x79,
	0x20, 0x66, 0x75, 0x72, 0x79, 0x20, 0x6f, 0x66,

	0x20, 0x74, 0x68, 0x75, 0x6e, 0x64, 0x65, 0x72,
	0x2e
};
unsigned char const sk[SK_BYTES] = {
	0x43, 0xe9, 0x20, 0x71, 0x75, 0x27, 0xe8, 0x20,
	0x6c, 0x61, 0x69, 0x6e, 0xf4, 0x2c, 0x20, 0x6c,
	0x65, 0x20, 0x4d, 0x61, 0x69, 0x74, 0x72, 0x65,
	0x20, 0x64, 0xe9, 0x20, 0x62, 0x61, 0x74, 0x61,

	0x69, 0x6c, 0x6c, 0x65, 0x2c, 0x20, 0x51, 0x75,
	0x65, 0x20, 0x73, 0x65, 0x20, 0x6d, 0x6f, 0x71,
	0x75, 0xe9, 0x20, 0x65, 0x74, 0x20, 0x73, 0x65,
	0x20, 0x72, 0x69, 0x20, 0x64, 0xe9, 0x20, 0x63
};
unsigned char const masks[MASKS_BYTES] = {
	0x61, 0x6e, 0x61, 0x69, 0x6c, 0x6c, 0x65, 0x2c,
	0x20, 0x41, 0x20, 0x62, 0x69, 0x6e, 0x20, 0x66,
	0x61, 0x69, 0x20, 0x76, 0x69, 0x2c, 0x20, 0x70,
	0xe8, 0x20, 0x6f, 0x6e, 0x20, 0x64, 0x65, 0x73,
	
	0x61, 0x6e, 0x64, 0x65, 0x20, 0x6e, 0x61, 0x69,
	0x2c, 0x20, 0x51, 0x75, 0x27, 0x69, 0x6c, 0x20,
	0xe9, 0x74, 0x69, 0x76, 0xe9, 0x20, 0x70, 0x61,
	0x74, 0x72, 0x6f, 0x6e, 0x20, 0x64, 0xe9, 0x20,

	0x47, 0x65, 0x6e, 0x65, 0x76, 0x6f, 0x69, 0x2e,
	0x20, 0x49, 0x20, 0x73, 0x6f, 0x6e, 0x20, 0x76,
	0x65, 0x67, 0x6e, 0x75, 0x20, 0x6c, 0x65, 0x20,
	0x64, 0x6f, 0x7a, 0x65, 0x20, 0x64, 0x65, 0x20,
	
	0x64, 0x65, 0x73, 0x73, 0x61, 0x6e, 0x62, 0x72,
	0x6f, 0x2c, 0x20, 0x50, 0xe8, 0x20, 0x6f, 0x6e,
	0x6e, 0x61, 0x20, 0x6e, 0x61, 0x69, 0x20, 0x61,
	0x73, 0x73, 0x65, 0x20, 0x6e, 0x61, 0x69, 0x72,
	

	0x65, 0x20, 0x71, 0x75, 0x65, 0x20, 0x64, 0x27,
	0x61, 0x6e, 0x63, 0x72, 0x6f, 0x3b, 0x20, 0x59,
	0x20, 0xe9, 0x74, 0x69, 0x76, 0xe9, 0x20, 0x6c,
	0x27, 0x61, 0x6e, 0x20, 0x6d, 0x69, 0x6c, 0x20,
	
	0x73, 0x69, 0x20, 0x73, 0x61, 0x6e, 0x20, 0x65,
	0x74, 0x20, 0x64, 0x6f, 0x75, 0x2c, 0x20, 0x51,
	0x75, 0x27, 0x69, 0x20, 0x76, 0x65, 0x6e, 0x69,
	0x72, 0x6f, 0x6e, 0x20, 0x70, 0x61, 0x72, 0x6c,
	
	0x61, 0x20, 0x6f, 0x75, 0x20, 0x70, 0x6f, 0x75,
	0x20, 0x74, 0x72, 0x6f, 0x69, 0x20, 0x74, 0x6f,
	0x75, 0x2e, 0x20, 0x50, 0xe8, 0x20, 0x6f, 0x6e,
	0x6e, 0x61, 0x20, 0x6e, 0x61, 0x69, 0x20, 0x71,
	
	0x75, 0x27, 0xe9, 0x74, 0x69, 0x76, 0x65, 0x20,
	0x6c, 0x61, 0x20, 0x70, 0x65, 0x20, 0x6e, 0x61,
	0x69, 0x72, 0x65, 0x2c, 0x20, 0x49, 0x20, 0x76,
	0x65, 0x6e, 0x69, 0x72, 0x6f, 0x6e, 0x3b, 0x20,
	

	0x79, 0x20, 0x6e, 0x27, 0xe9, 0x74, 0x61, 0x69,
	0x20, 0x70, 0x61, 0x73, 0x20, 0x70, 0xe8, 0x20,
	0x62, 0x61, 0x69, 0x72, 0xe8, 0x3a, 0x20, 0x59,
	0x20, 0xe9, 0x74, 0x69, 0x76, 0xe9, 0x20, 0x70,
	
	0xe8, 0x20, 0x70, 0x69, 0x6c, 0x6c, 0x69, 0x20,
	0x6e, 0x6f, 0x75, 0x20, 0x6d, 0x61, 0x69, 0x73,
	0x6f, 0x6e, 0x2c, 0x20, 0x45, 0x74, 0x20, 0x6e,
	0x6f, 0x20, 0x74, 0xfc, 0x61, 0x20, 0x73, 0x61,
	
	0x6e, 0x73, 0x20, 0x61, 0x75, 0x63, 0x75, 0x6e,
	0x61, 0x20, 0x72, 0x61, 0x69, 0x73, 0x6f, 0x6e,
	0x20, 0x50, 0x65, 0x74, 0x69, 0x73, 0x20, 0x65,
	0x74, 0x20, 0x67, 0x72, 0x61, 0x6e, 0x73, 0x2c,
	
	0x20, 0x6f, 0x73, 0x73, 0x69, 0x73, 0x20, 0x61,
	0x6e, 0x20, 0x73, 0x65, 0x76, 0x65, 0x67, 0x6e,
	0x61, 0x6e, 0x63, 0x65, 0x3a, 0x20, 0x50, 0xe8,
	0x20, 0x6f, 0x6e, 0x20, 0x6d, 0x61, 0x74, 0x69,
	

	0x6e, 0x20, 0x64, 0x27, 0x6f, 0x6e, 0x6e, 0x61,
	0x20, 0x62, 0x65, 0x6c, 0x6c, 0x61, 0x20, 0x64,
	0x65, 0x6d, 0x61, 0x6e, 0x7a, 0x65, 0x2c, 0x20,
	0x45, 0x74, 0x20, 0x70, 0xe8, 0x20, 0x6f, 0x6e,
	
	0x20, 0x7a, 0x65, 0x75, 0x72, 0x20, 0x71, 0x75,
	0x27, 0x79, 0x20, 0x66, 0x61, 0x73, 0x73, 0x69,
	0x76, 0x65, 0x20, 0x62, 0x69, 0x6e, 0x20, 0x66,
	0x72, 0x61, 0x69, 0x2c, 0x20, 0x53, 0x61, 0x6e,
	
	0x73, 0x20, 0x6c, 0x65, 0x20, 0x62, 0x6f, 0x6e,
	0x20, 0x44, 0x69, 0x2c, 0x20, 0x6e, 0x6f, 0x73,
	0x20, 0xe9, 0x74, 0x69, 0x76, 0x6f, 0x6e, 0x20,
	0x74, 0x6f, 0x20, 0x70, 0x72, 0x61, 0x69, 0x21,
	
	0x20, 0x4f, 0x6e, 0x20, 0x76, 0x6f, 0x20, 0x64,
	0x65, 0x72, 0x61, 0x20, 0x71, 0x75, 0x27, 0xe9,
	0x74, 0x61, 0x69, 0x20, 0x63, 0x65, 0x6c, 0x61,
	0x20, 0x63, 0x61, 0x6e, 0x61, 0x69, 0x6c, 0x6c,
	

	0x65, 0x2e, 0x20, 0x2d, 0x20, 0x4c, 0x6f, 0x75,
	0x20, 0x53, 0x61, 0x76, 0x6f, 0x79, 0x61, 0x72,
	0x20, 0x63, 0x6f, 0x6e, 0x74, 0x72, 0x65, 0x20,
	0x6e, 0x6f, 0x75, 0x74, 0x72, 0x61, 0x20, 0x6d,
	
	0x6f, 0x75, 0x72, 0x61, 0x69, 0x6c, 0x6c, 0x65,
	0x20, 0x54, 0x72, 0x61, 0x69, 0x20, 0x65, 0x69,
	0x74, 0x69, 0x65, 0x6c, 0x6c, 0xe9, 0x20, 0x6f,
	0x6e, 0x20, 0x64, 0x72, 0x65, 0x73, 0x73, 0x69,
	
	0x61, 0x20, 0x65, 0x74, 0x20, 0x70, 0x6c, 0x69,
	0x61, 0x6e, 0x74, 0x61, 0x2c, 0x20, 0x45, 0x74,
	0x20, 0x70, 0x61, 0x72, 0x20, 0x69, 0x71, 0x75,
	0xe9, 0x20, 0x64, 0x6f, 0x75, 0x20, 0x73, 0x61,
	
	0x6e, 0x20, 0x79, 0x20, 0x73, 0x6f, 0x6e, 0x20,
	0x6d, 0x6f, 0x6e, 0x74, 0x61, 0x2e, 0x20, 0x45,
	0x74, 0x69, 0x61, 0x6e, 0x20, 0x61, 0x6e, 0x74,
	0x72, 0x61, 0x2c, 0x20, 0x76, 0x65, 0x6e, 0x69,
	

	0x72, 0x6f, 0x6e, 0x20, 0x75, 0x20, 0x63, 0x6f,
	0x75, 0x72, 0x64, 0x65, 0x67, 0x61, 0x72, 0x64,
	0x61, 0x2c, 0x20, 0x59, 0x6f, 0x20, 0x69, 0x20,
	0x66, 0x69, 0x72, 0x6f, 0x6e, 0x20, 0x6f, 0x6e,
	
	0x6e, 0x61, 0x20, 0x72, 0x75, 0x64, 0x61, 0x20,
	0x6d, 0x6f, 0x6e, 0x74, 0x61, 0x64, 0x61, 0x2e,
	0x20, 0x49, 0x73, 0x20, 0x61, 0x76, 0x69, 0x6f,
	0x6e, 0x20, 0x74, 0x65, 0x6e, 0x61, 0x69, 0x6c,
	
	0x6c, 0xe9, 0x20, 0x65, 0x74, 0x20, 0x6d, 0x61,
	0x72, 0x74, 0xe9, 0x20, 0x51, 0x75, 0x27, 0xe9,
	0x74, 0x69, 0x76, 0x6f, 0x6e, 0x20, 0x66, 0x61,
	0x69, 0x20, 0x61, 0x76, 0x6f, 0x69, 0x20, 0x64,
	
	0x75, 0x20, 0x62, 0x6f, 0x75, 0x6e, 0x20, 0x61,
	0x63, 0x69, 0xe9, 0x2c, 0x20, 0x50, 0xe8, 0x20,
	0x61, 0x72, 0x72, 0x61, 0x63, 0x69, 0x20, 0x6c,
	0x6f, 0x75, 0x20, 0x63, 0x6c, 0x69, 0x6f, 0x75,
	

	0x20, 0x65, 0x74, 0x20, 0x6c, 0xe9, 0x20, 0x73,
	0x61, 0x72, 0x61, 0x69, 0x6c, 0x6c, 0x65, 0x2c,
	0x20, 0x54, 0x6f, 0x20, 0x6c, 0x6f, 0x75, 0x20,
	0x76, 0x65, 0x72, 0x72, 0x65, 0x75, 0x20, 0x65,
	
	0x74, 0x20, 0x74, 0x6f, 0x74, 0x61, 0x20, 0x6c,
	0x61, 0x20, 0x66, 0xe9, 0x72, 0x61, 0x69, 0x6c,
	0x6c, 0x65, 0x20, 0x51, 0x75, 0x27, 0x6f, 0x6e,
	0x20, 0x72, 0x61, 0x6e, 0x63, 0x6f, 0x6e, 0x74,
	
	0x72, 0xe9, 0x20, 0x61, 0x6e, 0x20, 0x64, 0xe9,
	0x20, 0x70, 0x61, 0x72, 0x69, 0x20, 0x61, 0x6e,
	0x64, 0x72, 0x61, 0x69, 0x2c, 0x20, 0x45, 0x74,
	0x20, 0x71, 0x75, 0x27, 0x6f, 0x6e, 0x20, 0x62,
	
	0x6f, 0x75, 0x74, 0xe9, 0x20, 0x70, 0xe8, 0x20,
	0x6e, 0x27, 0x65, 0x69, 0x74, 0x72, 0x65, 0x20,
	0x70, 0x61, 0x73, 0x20, 0x73, 0x75, 0x72, 0x70,
	0x72, 0x61, 0x69, 0x2e, 0x20, 0x4f, 0x6e, 0x20,
	

	0x65, 0x69, 0x74, 0x61, 0x62, 0x6c, 0x69, 0x6f,
	0x20, 0x69, 0x73, 0x20, 0x61, 0x76, 0x69, 0x76,
	0x6f, 0x6e, 0x20, 0x66, 0x6f, 0x72, 0x63, 0x69,
	0x61, 0x3b, 0x20, 0x45, 0x74, 0x20, 0x64, 0x27,

	0x6f, 0x6e, 0x20, 0x70, 0x65, 0x74, 0x61, 0x72,
	0x20, 0x71, 0x75, 0x27, 0x69, 0x73, 0x20, 0x61,
	0x76, 0x69, 0x76, 0x6f, 0x6e, 0x20, 0x74, 0x65,
	0x72, 0x69, 0x61, 0x2c, 0x20, 0x49, 0x20, 0x63,

	0x6f, 0x75, 0x64, 0x61, 0x76, 0x6f, 0x6e, 0x20,
	0x64, 0x65, 0x69, 0x7a, 0x61, 0x20, 0x65, 0x69,
	0x74, 0x72, 0x65, 0x20, 0xe0, 0x20, 0x73, 0x65,
	0x76, 0x61, 0x75, 0x3a, 0x20, 0x49, 0x20, 0x6e,

	0x27, 0xe9, 0x74, 0x69, 0x76, 0x6f, 0x6e, 0x20,
	0x70, 0x61, 0x73, 0x20, 0x61, 0x73, 0x73, 0xe9,
	0x20, 0x6d, 0x6f, 0x6e, 0x74, 0x61, 0x20, 0x79,
	0x6f, 0x2e, 0x20, 0x53, 0x65, 0x6e, 0x20, 0x41
};

#define STRING_EOL    "\r"
#define STRING_HEADER "-- SPHINCS Main Project --\r\n" \
		"-- "BOARD_NAME" --\r\n" \
		"-- Compiled: "__DATE__" "__TIME__" --"STRING_EOL

#define STRING_FOOTER STRING_EOL"-- END --"

/// @cond 0
/**INDENT-OFF**/
#ifdef __cplusplus
extern "C" {
#endif
/**INDENT-ON**/
/// @endcond

/**
 *  Configure UART console.
 */

static void configure_console(void)
{
	const usart_serial_options_t uart_serial_options = {
		.baudrate = CONF_UART_BAUDRATE,
#ifdef CONF_UART_CHAR_LENGTH
		.charlength = CONF_UART_CHAR_LENGTH,
#endif
		.paritytype = CONF_UART_PARITY,
#ifdef CONF_UART_STOP_BITS
		.stopbits = CONF_UART_STOP_BITS,
#endif
	};

	/* Configure console UART. */
	sysclk_enable_peripheral_clock(CONSOLE_UART_ID);
	stdio_serial_init(CONF_UART, &uart_serial_options);
}

/**
 *  \brief getting-started Application entry point.
 *
 *  \return Unused (ANSI-C compatibility).
 */

int main(void)
{
	/* Initialize the SAM system */
	sysclk_init();
	board_init();

	/* Initialize the console UART */
	configure_console();

	/* Output example information */
	puts(STRING_HEADER);

	/* SPHINCS signature */
	sphincs_sign(message, MESSAGE_BYTES, sk, masks);

	/* Output end */
	puts(STRING_FOOTER);

	/* Block infinitely */
	while (1);
}

/// @cond 0
/**INDENT-OFF**/
#ifdef __cplusplus
}
#endif
/**INDENT-ON**/
/// @endcond
